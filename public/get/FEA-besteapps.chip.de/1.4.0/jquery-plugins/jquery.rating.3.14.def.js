define(["jquery"],function(t){if(t.browser.msie)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}t.fn.rating=function(e){if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var i=arguments;return this.each(function(){t.fn.rating.apply(t(this),i)})}return t.fn.rating[arguments[0]].apply(this,t.makeArray(arguments).slice(1)||[]),this}var e=t.extend({},t.fn.rating.options,e||{});return t.fn.rating.calls++,this.not(".star-rating-applied").addClass("star-rating-applied").each(function(){var i,n=t(this),a=(this.name||"unnamed-rating").replace(/\[|\]/g,"_").replace(/^\_+|\_+$/g,""),o=t(this.form||document.body),r=o.data("rating");r&&r.call==t.fn.rating.calls||(r={count:0,call:t.fn.rating.calls});var s=r[a];s&&(i=s.data("rating")),s&&i?i.count++:(i=t.extend({},e||{},(t.metadata?n.metadata():t.meta?n.data():null)||{},{count:0,stars:[],inputs:[]}),i.serial=r.count++,s=t('<span class="star-rating-control"/>'),n.before(s),s.addClass("rating-to-be-drawn"),(n.attr("disabled")||n.hasClass("disabled"))&&(i.readOnly=!0),n.hasClass("required")&&(i.required=!0),s.append(i.cancel=t('<div class="rating-cancel"><a title="'+i.cancel+'">'+i.cancelValue+"</a></div>").mouseover(function(){t(this).rating("drain"),t(this).addClass("star-rating-hover")}).mouseout(function(){t(this).rating("draw"),t(this).removeClass("star-rating-hover")}).click(function(){t(this).rating("select")}).data("rating",i)));var c=t('<div class="star-rating rater-'+i.serial+'"><a title="'+(this.title||this.value)+'">'+this.value+"</a></div>");if(s.append(c),this.id&&c.attr("id",this.id),this.className&&c.addClass(this.className),i.half&&(i.split=2),"number"==typeof i.split&&i.split>0){var l=(t.fn.width?c.width():0)||i.starWidth,d=i.count%i.split,u=Math.floor(l/i.split);c.width(u).find("a").css({"margin-left":"-"+d*u+"px"})}i.readOnly?c.addClass("star-rating-readonly"):c.addClass("star-rating-live").mouseover(function(){t(this).rating("fill"),t(this).rating("focus")}).mouseout(function(){t(this).rating("draw"),t(this).rating("blur")}).click(function(){t(this).rating("select")}),this.checked&&(i.current=c),"A"==this.nodeName&&t(this).hasClass("selected")&&(i.current=c),n.hide(),n.change(function(){t(this).rating("select")}),c.data("rating.input",n.data("rating.star",c)),i.stars[i.stars.length]=c[0],i.inputs[i.inputs.length]=n[0],i.rater=r[a]=s,i.context=o,n.data("rating",i),s.data("rating",i),c.data("rating",i),o.data("rating",r)}),t(".rating-to-be-drawn").rating("draw").removeClass("rating-to-be-drawn"),this},t.extend(t.fn.rating,{calls:0,focus:function(){var e=this.data("rating");if(!e)return this;if(!e.focus)return this;var i=t(this).data("rating.input")||t("INPUT"==this.tagName?this:null);e.focus&&e.focus.apply(i[0],[i.val(),t("a",i.data("rating.star"))[0]])},blur:function(){var e=this.data("rating");if(!e)return this;if(!e.blur)return this;var i=t(this).data("rating.input")||t("INPUT"==this.tagName?this:null);e.blur&&e.blur.apply(i[0],[i.val(),t("a",i.data("rating.star"))[0]])},fill:function(){var t=this.data("rating");return t?(t.readOnly||(this.rating("drain"),this.prevAll().andSelf().filter(".rater-"+t.serial).addClass("star-rating-hover")),void 0):this},drain:function(){var t=this.data("rating");return t?(t.readOnly||t.rater.children().filter(".rater-"+t.serial).removeClass("star-rating-on").removeClass("star-rating-hover"),void 0):this},draw:function(){var e=this.data("rating");return e?(this.rating("drain"),e.current?(e.current.data("rating.input").attr("checked","checked"),e.current.prevAll().andSelf().filter(".rater-"+e.serial).addClass("star-rating-on")):t(e.inputs).removeAttr("checked"),e.cancel[e.readOnly||e.required?"hide":"show"](),this.siblings()[e.readOnly?"addClass":"removeClass"]("star-rating-readonly"),void 0):this},select:function(e,i){var n=this.data("rating");if(!n)return this;if(!n.readOnly){if(n.current=null,e!==void 0){if("number"==typeof e)return t(n.stars[e]).rating("select",void 0,i);"string"==typeof e&&t.each(n.stars,function(){t(this).data("rating.input").val()==e&&t(this).rating("select",void 0,i)})}else n.current="INPUT"==this[0].tagName?this.data("rating.star"):this.is(".rater-"+n.serial)?this:null;this.data("rating",n),this.rating("draw");var a=t(n.current?n.current.data("rating.input"):null);(i||void 0==i)&&n.callback&&n.callback.apply(a[0],[a.val(),t("a",n.current)[0]])}},readOnly:function(e,i){var n=this.data("rating");return n?(n.readOnly=e||void 0==e?!0:!1,i?t(n.inputs).attr("disabled","disabled"):t(n.inputs).removeAttr("disabled"),this.data("rating",n),this.rating("draw"),void 0):this},disable:function(){this.rating("readOnly",!0,!0)},enable:function(){this.rating("readOnly",!1,!1)}}),t.fn.rating.options={cancel:"Cancel Rating",cancelValue:"",split:0,starWidth:16},t(function(){t("input[type=radio].star").rating()})});