define(["jquery","requireCSS!jquery-plugins/jquery.jscrollpane.css","requireCSS!jquery-plugins/jquery.jscrollpane.lozenge.css"],function(t){(function(t,e,i){t.fn.jScrollPane=function(e){function n(e,n){function o(n){var r,c,d,u,p,g,m=!1,v=!1;if(E=n,Y===i)p=e.scrollTop(),g=e.scrollLeft(),e.css({overflow:"hidden",padding:0}),N=e.innerWidth()+ye,R=e.innerHeight(),e.width(N),Y=t('<div class="jspPane" />').css("padding",be).append(e.children()),$=t('<div class="jspContainer" />').css({width:N+"px",height:R+"px"}).append(Y).appendTo(e);else{if(e.css("width",""),m=E.stickToBottom&&I(),v=E.stickToRight&&S(),u=e.innerWidth()+ye!=N||e.outerHeight()!=R,u&&(N=e.innerWidth()+ye,R=e.innerHeight(),$.css({width:N+"px",height:R+"px"})),!u&&we==V&&Y.outerHeight()==G)return e.width(N),i;we=V,Y.css("width",""),e.width(N),$.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}Y.css("overflow","auto"),V=n.contentWidth?n.contentWidth:Y[0].scrollWidth,G=Y[0].scrollHeight,Y.css("overflow",""),U=V/N,K=G/R,_=K>1,Q=U>1,Q||_?(e.addClass("jspScrollable"),r=E.maintainPosition&&(te||ne),r&&(c=T(),d=q()),a(),s(),l(),r&&(C(v?V-N:c,!1),j(m?G-R:d,!1)),B(),D(),X(),E.enableKeyboardNavigation&&z(),E.clickOnTrack&&h(),F(),E.hijackInternalLinks&&L()):(e.removeClass("jspScrollable"),Y.css({top:0,width:$.width()-ye}),A(),P(),H(),f(),M()),E.autoReinitialise&&!ve?ve=setInterval(function(){o(E)},E.autoReinitialiseDelay):!E.autoReinitialise&&ve&&clearInterval(ve),p&&e.scrollTop(0)&&j(p,!1),g&&e.scrollLeft(0)&&C(g,!1),e.trigger("jsp-initialised",[Q||_])}function a(){_&&($.append(t('<div class="jspVerticalBar" />').append(t('<div class="jspCap jspCapTop" />'),t('<div class="jspTrack" />').append(t('<div class="jspDrag" />').append(t('<div class="jspDragTop" />'),t('<div class="jspDragBottom" />'))),t('<div class="jspCap jspCapBottom" />'))),oe=$.find(">.jspVerticalBar"),ae=oe.find(">.jspTrack"),Z=ae.find(">.jspDrag"),E.showArrows&&(le=t('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",u(0,-1)).bind("click.jsp",O),de=t('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",u(0,1)).bind("click.jsp",O),E.arrowScrollOnHover&&(le.bind("mouseover.jsp",u(0,-1,le)),de.bind("mouseover.jsp",u(0,1,de))),d(ae,E.verticalArrowPositions,le,de)),se=R,$.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){se-=t(this).outerHeight()}),Z.hover(function(){Z.addClass("jspHover")},function(){Z.removeClass("jspHover")}).bind("mousedown.jsp",function(e){t("html").bind("dragstart.jsp selectstart.jsp",O),Z.addClass("jspActive");var i=e.pageY-Z.position().top;return t("html").bind("mousemove.jsp",function(t){m(t.pageY-i,!1)}).bind("mouseup.jsp mouseleave.jsp",g),!1}),r())}function r(){ae.height(se+"px"),te=0,re=E.verticalGutter+ae.outerWidth(),Y.width(N-re-ye);try{0===oe.position().left&&Y.css("margin-left",re+"px")}catch(t){}}function s(){Q&&($.append(t('<div class="jspHorizontalBar" />').append(t('<div class="jspCap jspCapLeft" />'),t('<div class="jspTrack" />').append(t('<div class="jspDrag" />').append(t('<div class="jspDragLeft" />'),t('<div class="jspDragRight" />'))),t('<div class="jspCap jspCapRight" />'))),ue=$.find(">.jspHorizontalBar"),pe=ue.find(">.jspTrack"),ee=pe.find(">.jspDrag"),E.showArrows&&(ge=t('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",u(-1,0)).bind("click.jsp",O),me=t('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",u(1,0)).bind("click.jsp",O),E.arrowScrollOnHover&&(ge.bind("mouseover.jsp",u(-1,0,ge)),me.bind("mouseover.jsp",u(1,0,me))),d(pe,E.horizontalArrowPositions,ge,me)),ee.hover(function(){ee.addClass("jspHover")},function(){ee.removeClass("jspHover")}).bind("mousedown.jsp",function(e){t("html").bind("dragstart.jsp selectstart.jsp",O),ee.addClass("jspActive");var i=e.pageX-ee.position().left;return t("html").bind("mousemove.jsp",function(t){b(t.pageX-i,!1)}).bind("mouseup.jsp mouseleave.jsp",g),!1}),he=$.innerWidth(),c())}function c(){$.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){he-=t(this).outerWidth()}),pe.width(he+"px"),ne=0}function l(){if(Q&&_){var e=pe.outerHeight(),i=ae.outerWidth();se-=e,t(ue).find(">.jspCap:visible,>.jspArrow").each(function(){he+=t(this).outerWidth()}),he-=i,R-=i,N-=e,pe.parent().append(t('<div class="jspCorner" />').css("width",e+"px")),r(),c()}Q&&Y.width($.outerWidth()-ye+"px"),G=Y.outerHeight(),K=G/R,Q&&(fe=Math.ceil(1/U*he),fe>E.horizontalDragMaxWidth?fe=E.horizontalDragMaxWidth:E.horizontalDragMinWidth>fe&&(fe=E.horizontalDragMinWidth),ee.width(fe+"px"),ie=he-fe,y(ne)),_&&(ce=Math.ceil(1/K*se),ce>E.verticalDragMaxHeight?ce=E.verticalDragMaxHeight:E.verticalDragMinHeight>ce&&(ce=E.verticalDragMinHeight),Z.height(ce+"px"),J=se-ce,v(te))}function d(t,e,i,n){var o,a="before",r="after";"os"==e&&(e=/Mac/.test(navigator.platform)?"after":"split"),e==a?r=e:e==r&&(a=e,o=i,i=n,n=o),t[a](i)[r](n)}function u(t,e,i){return function(){return p(t,e,this,i),this.blur(),!1}}function p(e,i,n,o){n=t(n).addClass("jspActive");var a,r,s=!0,c=function(){0!==e&&xe.scrollByX(e*E.arrowButtonSpeed),0!==i&&xe.scrollByY(i*E.arrowButtonSpeed),r=setTimeout(c,s?E.initialDelay:E.arrowRepeatFreq),s=!1};c(),a=o?"mouseout.jsp":"mouseup.jsp",o=o||t("html"),o.bind(a,function(){n.removeClass("jspActive"),r&&clearTimeout(r),r=null,o.unbind(a)})}function h(){f(),_&&ae.bind("mousedown.jsp",function(e){if(e.originalTarget===i||e.originalTarget==e.currentTarget){var n,o=t(this),a=o.offset(),r=e.pageY-a.top-te,s=!0,c=function(){var t=o.offset(),a=e.pageY-t.top-ce/2,d=R*E.scrollPagePercent,u=J*d/(G-R);if(0>r)te-u>a?xe.scrollByY(-d):m(a);else{if(!(r>0))return l(),i;a>te+u?xe.scrollByY(d):m(a)}n=setTimeout(c,s?E.initialDelay:E.trackClickRepeatFreq),s=!1},l=function(){n&&clearTimeout(n),n=null,t(document).unbind("mouseup.jsp",l)};return c(),t(document).bind("mouseup.jsp",l),!1}}),Q&&pe.bind("mousedown.jsp",function(e){if(e.originalTarget===i||e.originalTarget==e.currentTarget){var n,o=t(this),a=o.offset(),r=e.pageX-a.left-ne,s=!0,c=function(){var t=o.offset(),a=e.pageX-t.left-fe/2,d=N*E.scrollPagePercent,u=ie*d/(V-N);if(0>r)ne-u>a?xe.scrollByX(-d):b(a);else{if(!(r>0))return l(),i;a>ne+u?xe.scrollByX(d):b(a)}n=setTimeout(c,s?E.initialDelay:E.trackClickRepeatFreq),s=!1},l=function(){n&&clearTimeout(n),n=null,t(document).unbind("mouseup.jsp",l)};return c(),t(document).bind("mouseup.jsp",l),!1}})}function f(){pe&&pe.unbind("mousedown.jsp"),ae&&ae.unbind("mousedown.jsp")}function g(){t("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),Z&&Z.removeClass("jspActive"),ee&&ee.removeClass("jspActive")}function m(t,e){_&&(0>t?t=0:t>J&&(t=J),e===i&&(e=E.animateScroll),e?xe.animate(Z,"top",t,v):(Z.css("top",t),v(t)))}function v(t){t===i&&(t=Z.position().top),$.scrollTop(0),te=t;var n=0===te,o=te==J,a=t/J,r=-a*(G-R);(je!=n||ke!=o)&&(je=n,ke=o,e.trigger("jsp-arrow-change",[je,ke,Ce,Te])),w(n,o),Y.css("top",r),e.trigger("jsp-scroll-y",[-r,n,o]).trigger("scroll")}function b(t,e){Q&&(0>t?t=0:t>ie&&(t=ie),e===i&&(e=E.animateScroll),e?xe.animate(ee,"left",t,y):(ee.css("left",t),y(t)))}function y(t){t===i&&(t=ee.position().left),$.scrollTop(0),ne=t;var n=0===ne,o=ne==ie,a=t/ie,r=-a*(V-N);(Ce!=n||Te!=o)&&(Ce=n,Te=o,e.trigger("jsp-arrow-change",[je,ke,Ce,Te])),x(n,o),Y.css("left",r),e.trigger("jsp-scroll-x",[-r,n,o]).trigger("scroll")}function w(t,e){E.showArrows&&(le[t?"addClass":"removeClass"]("jspDisabled"),de[e?"addClass":"removeClass"]("jspDisabled"))}function x(t,e){E.showArrows&&(ge[t?"addClass":"removeClass"]("jspDisabled"),me[e?"addClass":"removeClass"]("jspDisabled"))}function j(t,e){var i=t/(G-R);m(i*J,e)}function C(t,e){var i=t/(V-N);b(i*ie,e)}function k(e,i,n){var o,a,r,s,c,l,d,u,p,h=0,f=0;try{o=t(e)}catch(g){return}for(a=o.outerHeight(),r=o.outerWidth(),$.scrollTop(0),$.scrollLeft(0);!o.is(".jspPane");)if(h+=o.position().top,f+=o.position().left,o=o.offsetParent(),/^body|html$/i.test(o[0].nodeName))return;s=q(),l=s+R,s>h||i?u=h-E.verticalGutter:h+a>l&&(u=h-R+a+E.verticalGutter),u&&j(u,n),c=T(),d=c+N,c>f||i?p=f-E.horizontalGutter:f+r>d&&(p=f-N+r+E.horizontalGutter),p&&C(p,n)}function T(){return-Y.position().left}function q(){return-Y.position().top}function I(){var t=G-R;return t>20&&10>t-q()}function S(){var t=V-N;return t>20&&10>t-T()}function D(){$.unbind(Ie).bind(Ie,function(t,e,i,n){var o=ne,a=te;return xe.scrollBy(i*E.mouseWheelSpeed,-n*E.mouseWheelSpeed,!1),o==ne&&a==te})}function A(){$.unbind(Ie)}function O(){return!1}function B(){Y.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(t){k(t.target,!1)})}function P(){Y.find(":input,a").unbind("focus.jsp")}function z(){function i(){var t=ne,e=te;switch(n){case 40:xe.scrollByY(E.keyboardSpeed,!1);break;case 38:xe.scrollByY(-E.keyboardSpeed,!1);break;case 34:case 32:xe.scrollByY(R*E.scrollPagePercent,!1);break;case 33:xe.scrollByY(-R*E.scrollPagePercent,!1);break;case 39:xe.scrollByX(E.keyboardSpeed,!1);break;case 37:xe.scrollByX(-E.keyboardSpeed,!1)}return o=t!=ne||e!=te}var n,o,a=[];Q&&a.push(ue[0]),_&&a.push(oe[0]),Y.focus(function(){e.focus()}),e.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(e){if(e.target===this||a.length&&t(e.target).closest(a).length){var r=ne,s=te;switch(e.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:n=e.keyCode,i();break;case 35:j(G-R),n=null;break;case 36:j(0),n=null}return o=e.keyCode==n&&r!=ne||s!=te,!o}}).bind("keypress.jsp",function(t){return t.keyCode==n&&i(),!o}),E.hideFocus?(e.css("outline","none"),"hideFocus"in $[0]&&e.attr("hideFocus",!0)):(e.css("outline",""),"hideFocus"in $[0]&&e.attr("hideFocus",!1))}function H(){e.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function F(){if(location.hash&&location.hash.length>1){var e,i,n=escape(location.hash);try{e=t(n)}catch(o){return}e.length&&Y.find(n)&&(0===$.scrollTop()?i=setInterval(function(){$.scrollTop()>0&&(k(n,!0),t(document).scrollTop($.position().top),clearInterval(i))},50):(k(n,!0),t(document).scrollTop($.position().top)))}}function M(){t("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function L(){M(),t("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var t,e=this.href.split("#");return e.length>1&&(t=e[1],t.length>0&&Y.find("#"+t).length>0)?(k("#"+t,!0),!1):i})}function X(){var t,e,n,o,a,r=!1;$.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(i){var s=i.originalEvent.touches[0];t=T(),e=q(),n=s.pageX,o=s.pageY,a=!1,r=!0}).bind("touchmove.jsp",function(i){if(r){var s=i.originalEvent.touches[0],c=ne,l=te;return xe.scrollTo(t+n-s.pageX,e+o-s.pageY),a=a||Math.abs(n-s.pageX)>5||Math.abs(o-s.pageY)>5,c==ne&&l==te}}).bind("touchend.jsp",function(){r=!1}).bind("click.jsp-touchclick",function(){return a?(a=!1,!1):i})}function W(){var t=q(),i=T();e.removeClass("jspScrollable").unbind(".jsp"),e.replaceWith(qe.append(Y.children())),qe.scrollTop(t),qe.scrollLeft(i)}var E,Y,N,R,$,V,G,U,K,_,Q,Z,J,te,ee,ie,ne,oe,ae,re,se,ce,le,de,ue,pe,he,fe,ge,me,ve,be,ye,we,xe=this,je=!0,Ce=!0,ke=!1,Te=!1,qe=e.clone(!1,!1).empty(),Ie=t.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";be=e.css("paddingTop")+" "+e.css("paddingRight")+" "+e.css("paddingBottom")+" "+e.css("paddingLeft"),ye=(parseInt(e.css("paddingLeft"),10)||0)+(parseInt(e.css("paddingRight"),10)||0),t.extend(xe,{reinitialise:function(e){e=t.extend({},E,e),o(e)},scrollToElement:function(t,e,i){k(t,e,i)},scrollTo:function(t,e,i){C(t,i),j(e,i)},scrollToX:function(t,e){C(t,e)},scrollToY:function(t,e){j(t,e)},scrollToPercentX:function(t,e){C(t*(V-N),e)},scrollToPercentY:function(t,e){j(t*(G-R),e)},scrollBy:function(t,e,i){xe.scrollByX(t,i),xe.scrollByY(e,i)},scrollByX:function(t,e){var i=T()+Math[0>t?"floor":"ceil"](t),n=i/(V-N);b(n*ie,e)},scrollByY:function(t,e){var i=q()+Math[0>t?"floor":"ceil"](t),n=i/(G-R);m(n*J,e)},positionDragX:function(t,e){b(t,e)},positionDragY:function(t,e){m(t,e)},animate:function(t,e,i,n){var o={};o[e]=i,t.animate(o,{duration:E.animateDuration,easing:E.animateEase,queue:!1,step:n})},getContentPositionX:function(){return T()},getContentPositionY:function(){return q()},getContentWidth:function(){return V},getContentHeight:function(){return G},getPercentScrolledX:function(){return T()/(V-N)},getPercentScrolledY:function(){return q()/(G-R)},getIsScrollableH:function(){return Q},getIsScrollableV:function(){return _},getContentPane:function(){return Y},scrollToBottom:function(t){m(J,t)},hijackInternalLinks:function(){L()},destroy:function(){W()}}),o(n)}return e=t.extend({},t.fn.jScrollPane.defaults,e),t.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){e[this]=e[this]||e.speed}),this.each(function(){var i=t(this),o=i.data("jsp");o?o.reinitialise(e):(o=new n(i,e),i.data("jsp",o))})},t.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:i,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}})(t,this)});