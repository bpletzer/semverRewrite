define(["require","jquery","vendor/core/mediator","vendor/core/annotationsLoader","cxo/system-information","searchConfig","searchConfig_mobile","requireCSS!auto-suggest/chip.auto-suggest.css"],function(e,t,n,i,o,a,r){"use strict";function s(e,n){return this.$frm=e,this.options=n,this.$input=t("#"+this.options.id_searchField,e),this.sInput=this.$input.val(),this.$results=t(),this.xhr=null,e.data(d,this)}var c,l={class_resultItem:"teaser",id_searchField:"q"},d="CHIP.AutoSuggest",u=t.extend({},l,o.getViewInfo().type===o.TYPE_DESKTOP?a:r),p="actionInProgress",h=function h(e){e.xhr&&e.xhr.abort(),e.$frm.addClass(p),e.xhr=t.ajax({url:(u.url||e.$frm.attr("action")).replace(".html",".htm"),dataType:"html",data:e.$frm.serialize()+"&ac=1",success:function(t){n.publish("success.on.ajax"),f(e,t)},error:function(){n.publish("error.on.ajax"),v(e)},complete:function(){e.$frm.removeClass(p),n.publish("complete.on.ajax"),e.xhr=null}})},f=function f(e,o){var a=e.$frm,r=t(o).css({left:0,position:"absolute",top:a.outerHeight(!0),width:"100%"}).addClass("dialog-modaless"),s=t(".result_active",a);a.parent().css({position:"relative",overflow:"visible"}),r=t("<div/>").append(r),i.init(r),r=r.children(),t("#"+u.id_searchField,a).parent().find(".search_results").length>0?t("#"+u.id_searchField,a).parent().find(".search_results").replaceWith(r):t("#"+u.id_searchField,a).parent().append(r),t(".search_result").hover(function(){t(".search_result").removeClass("result_active"),s=t(this)}),t("#"+u.id_searchField,a).keydown(function(e){var n,i;40===e.keyCode&&(n=s.next(),0!==n.length&&(s.removeClass("result_active"),n.addClass("result_active"),s=n)),38===e.keyCode&&(i=s.prev(),0!==i.length&&(s.removeClass("result_active"),i.addClass("result_active"),s=i)),13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),location.href=t("a",s).attr("href"))}),e.$results=r,t(document).on("click.autosuggest",function(n){t.contains(a[0],n.target)||t.contains(e.$results[0],n.target)||v(e)}),n.publish("auto-suggest.on.show",e)},g=function(e){var n=t(e.currentTarget).data(d),i=n.$input.val();return e.preventDefault(),"submit"===e.type?m(i,n):n.sInput!==i&&(n.sInput=i,c&&window.clearTimeout(c),c=window.setTimeout(function(){m(i,n)},u.searchDelay)),!1},m=function(e,t){e.length>u.min_letters?h(t):v(t)},v=function v(e){t(document).off("click.autosuggest"),e.$results.css("display","none"),t("#"+u.id_searchField).unbind("keydown"),n.publish("auto-suggest.on.hide",e)},y=function y(e,n){var i=new s(t(e),t.extend({},l,n)),o="";for(o in u.fieldValues)u.fieldValues.hasOwnProperty(o)&&t("#"+o,i).val(u.fieldValues[o]);i.on("submit keyup",g).on("paste",function(e){setTimeout(function(){g(e)},100)})};return{init:y}});