(function(e,t){"object"==typeof exports&&exports?module.exports=t:"function"==typeof define&&define.amd?define(t):e.Mustache=t})(this,function(){function e(e,t){return RegExp.prototype.test.call(e,t)}function t(t){return!e(h,t)}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return b[e]})}function r(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=e,this.parent=t,this.clearCache()}function a(){this.clearCache()}function s(e){function t(e,t,i){if(!n[e]){var r=s(t);n[e]=function(e,t){return r(e,t,i)}}return n[e]}var n={};return function(n,i,r){for(var o,a,s="",c=0,l=e.length;l>c;++c)switch(o=e[c],o[0]){case"#":a=r.slice(o[3],o[5]),s+=n._section(o[1],i,a,t(c,o[4],r));break;case"^":s+=n._inverted(o[1],i,t(c,o[4],r));break;case">":s+=n._partial(o[1],i);break;case"&":s+=n._name(o[1],i);break;case"name":s+=n._escaped(o[1],i);break;case"text":s+=o[1]}return s}}function c(e){for(var t,n=[],i=n,r=[],o=0,a=e.length;a>o;++o)switch(t=e[o],t[0]){case"#":case"^":r.push(t),i.push(t),i=t[4]=[];break;case"/":var s=r.pop();s[5]=t[2],i=r.length>0?r[r.length-1][4]:n;break;default:i.push(t)}return n}function l(e){for(var t,n,i=[],r=0,o=e.length;o>r;++r)t=e[r],"text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,i.push(t));return i}function u(e){return[RegExp(n(e[0])+"\\s*"),RegExp("\\s*"+n(e[1]))]}var d={};d.name="mustache.js",d.version="0.7.2",d.tags=["{{","}}"],d.Scanner=r,d.Context=o,d.Writer=a;var p=/\s*/,f=/\s+/,h=/\S/,g=/\s*=/,m=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/,y=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};d.escape=i,r.prototype.eos=function(){return""===this.tail},r.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},r.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},o.make=function(e){return e instanceof o?e:new o(e)},o.prototype.clearCache=function(){this._cache={}},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."===e)t=this.view;else for(var n=this;n;){if(e.indexOf(".")>0){var i=e.split("."),r=0;for(t=n.view;t&&i.length>r;)t=t[i[r++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(e,t){var n=this._cache[e];if(!n){var i=d.parse(e,t);n=this._cache[e]=this.compileTokens(i,e)}return n},a.prototype.compilePartial=function(e,t,n){var i=this.compile(t,n);return this._partialCache[e]=i,i},a.prototype.compileTokens=function(e,t){var n=s(e),i=this;return function(e,r){if(r)if("function"==typeof r)i._loadPartial=r;else for(var a in r)i.compilePartial(a,r[a]);return n(i,o.make(e),t)}},a.prototype.render=function(e,t,n){return this.compile(e)(t,n)},a.prototype._section=function(e,t,n,i){var r=t.lookup(e);switch(typeof r){case"object":if(y(r)){for(var o="",a=0,s=r.length;s>a;++a)o+=i(this,t.push(r[a]));return o}return r?i(this,t.push(r)):"";case"function":var c=this,l=function(e){return c.render(e,t)},u=r.call(t.view,n,l);return null!=u?u:"";default:if(r)return i(this,t)}return""},a.prototype._inverted=function(e,t,n){var i=t.lookup(e);return!i||y(i)&&0===i.length?n(this,t):""},a.prototype._partial=function(e,t){e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e));var n=this._partialCache[e];return n?n(t):""},a.prototype._name=function(e,t){var n=t.lookup(e);return"function"==typeof n&&(n=n.call(t.view)),null==n?"":n+""},a.prototype._escaped=function(e,t){return d.escape(this._name(e,t))},d.parse=function(e,i){function o(){if(k&&!C)for(;_.length;)j.splice(_.pop(),1);else _=[];k=!1,C=!1}if(e=e||"",i=i||d.tags,"string"==typeof i&&(i=i.split(f)),2!==i.length)throw Error("Invalid tags: "+i.join(", "));for(var a,s,h,y,b=u(i),w=new r(e),x=[],j=[],_=[],k=!1,C=!1;!w.eos();){if(a=w.pos,h=w.scanUntil(b[0]))for(var E=0,q=h.length;q>E;++E)y=h.charAt(E),t(y)?_.push(j.length):C=!0,j.push(["text",y,a,a+1]),a+=1,"\n"===y&&o();if(a=w.pos,!w.scan(b[0]))break;if(k=!0,s=w.scan(v)||"name",w.scan(p),"="===s)h=w.scanUntil(g),w.scan(g),w.scanUntil(b[1]);else if("{"===s){var T=RegExp("\\s*"+n("}"+i[1]));h=w.scanUntil(T),w.scan(m),w.scanUntil(b[1]),s="&"}else h=w.scanUntil(b[1]);if(!w.scan(b[1]))throw Error("Unclosed tag at "+w.pos);if("/"===s){if(0===x.length)throw Error('Unopened section "'+h+'" at '+a);var S=x.pop();if(S[1]!==h)throw Error('Unclosed section "'+S[1]+'" at '+a)}var I=[s,h,a,w.pos];if(j.push(I),"#"===s||"^"===s)x.push(I);else if("name"===s||"{"===s||"&"===s)C=!0;else if("="===s){if(i=h.split(f),2!==i.length)throw Error("Invalid tags at "+a+": "+i.join(", "));b=u(i)}}var S=x.pop();if(S)throw Error('Unclosed section "'+S[1]+'" at '+w.pos);return c(l(j))};var w=new a;return d.clearCache=function(){return w.clearCache()},d.compile=function(e,t){return w.compile(e,t)},d.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)},d.compileTokens=function(e,t){return w.compileTokens(e,t)},d.render=function(e,t,n){return w.render(e,t,n)},d.to_html=function(e,t,n,i){var r=d.render(e,t,n);return"function"!=typeof i?r:(i(r),void 0)},d}());