define(["require","module","./AdSystem"],function(req,module,AdSystem){var CXO=AdSystem.inherit(AdSystem);return CXO.SYSTEM_ID=module.id,CXO.callOpenX=function(val){var blob,worker,response=function(e){var t;try{t=new XMLHttpRequest,t.open("GET",e.data._url,!0),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&postMessage(t.responseText)},t.send()}catch(n){postMessage("Error occured")}};if(response="self.onmessage="+(""+response),window.Blob)try{blob=new Blob([response])}catch(e){blob=!1}else try{window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,blob=new BlobBuilder,blob.append(response),blob=blob.getBlob()}catch(e){}blob&&(worker=new Worker(URL.createObjectURL(blob)),worker.onmessage=function(e){var xmlString=event.data,xmldoc,nodes,zoneids,i,banner,zoneid,bannerNode;for(window.ActiveXObject?(xmldoc=new ActiveXObject("Microsoft.XMLDOM"),xmldoc.async="false",xmldoc.loadXML(xmlString)):(xmldoc=new DOMParser,xmldoc=xmldoc.parseFromString(xmlString,"text/xml")),nodes=xmldoc.getElementsByTagName("html"),zoneids=xmldoc.getElementsByTagName("zoneid"),i=0;nodes.length>i;i++)banner=decodeURIComponent(escape(nodes[i].textContent)),zoneid=decodeURIComponent(escape(zoneids[i].textContent)),"7"==zoneid&&(banner="<li>"+banner+"</li>"),bannerNode=document.getElementById(val.target_zone),bannerNode&&(bannerNode.innerHTML+=banner,bannerNode=bannerNode.childNodes[i]||bannerNode,bannerNode.getElementsByTagName("script")[0]&&eval(bannerNode.getElementsByTagName("script")[0].innerHTML))},worker.postMessage(val))},CXO});